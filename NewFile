pipeline {
    agent any

    environment {
        DEV_Creds = credentials('DEV_CredID')  // This should be a Jenkins credential (Username & Password)
    }

   

    stages {
        stage('Set Environment') {
            steps {
                script {
                    def instance_selected = params.InstanceURL.trim()
                    if (instance_selected == "DEV") {
                        env.USR = env.DEV_Creds_USR
                        env.PSW = env.DEV_Creds_PSW
                        env.serviceURL = env.DEV_URL
                        env.testInstance = env.test_Integration_Instance
                    }
                }
            }
        }

        stage('Import Integration') {
            steps {
                script {
                    def selectedOption = params.Import_Method.trim()
                    if (selectedOption == 'New') {
                        echo 'Adding new integration'

                        def integURL = "${env.serviceURL}/ic/api/integration/v1/integrations/archive?integrationInstance=${env.testInstance}"

                        def deployIntegCmd = """curl --location "${integURL}" ^
--user ${env.USR}:${env.PSW} ^
--form "file=@\\"${params.IARFileName}\\""
"""
                        bat(label: 'Import Integration', script: deployIntegCmd)
                    }
                }
            }
        }
    }
}
